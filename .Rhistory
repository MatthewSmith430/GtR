DF1<-dplyr::bind_cols(PersonRole,PROJ)
DF2<-tidyr::fill(DF1,colnames(PROJ))
DF2$project_title<-gsub("&amp;","and",DF2$project_title)
library(GtR)
library(GtR)
library(GtR)
library(GtR)
url<-"https://gtr.ukri.org:443/projects?ref=EP/I010947/1"
firmTEST<-httr::GET(url)
firmTEXT<-httr::content(firmTEST, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
ORG<-JLfirm$projectOverview$projectComposition
pt<-ORG$project$title
imp<-ORG$project$output
PUB<-nrow(ORG$project$publication)
imp_l<-list()
for (j in 1:length(imp)){
imp_l[[j]]<-length(imp[[j]])
}
imp_info<-data.frame(name=names(imp),len=unlist(imp_l))
CO<-dplyr::filter(imp_info,
imp_info$name=="collaborationOutput")
if(CO$len!=0){
CO_imp<-nrow(imp[["collaborationOutput"]])
}else{
CO_imp<-0
}
IP<-dplyr::filter(imp_info,
imp_info$name=="intellectualPropertyOutput")
if(IP$len!=0){
IP_imp<-nrow(imp[["intellectualPropertyOutput"]])
}else{
IP_imp<-0
}
POL<-dplyr::filter(imp_info,
imp_info$name=="policyInfluenceOutput")
if(POL$len!=0){
POL_imp<-nrow(imp[["policyInfluenceOutput"]])
}else{
POL_imp<-0
}
PROD<-dplyr::filter(imp_info,
imp_info$name=="productOutput")
if(PROD$len!=0){
PROD_imp<-nrow(imp[["productOutput"]])
}else{
PROD_imp<-0
}
RM<-dplyr::filter(imp_info,
imp_info$name=="researchMaterialOutput")
if(RM$len!=0){
RM_imp<-nrow(imp[["researchMaterialOutput"]])
}else{
RM_imp<-0
}
ART<-dplyr::filter(imp_info,
imp_info$name=="artisticAndCreativeProductOutput")
if(ART$len!=0){
ART_imp<-nrow(imp[["artisticAndCreativeProductOutput"]])
}else{
ART_imp<-0
}
SOFT<-dplyr::filter(imp_info,
imp_info$name=="softwareAndTechnicalProductOutput")
if(SOFT$len!=0){
SOFT_imp<-nrow(imp[["softwareAndTechnicalProductOutput"]])
}else{
SOFT_imp<-0
}
RESDATA<-dplyr::filter(imp_info,
imp_info$name=="researchDatabaseAndModelOutput")
if(RESDATA$len!=0){
RESDATA_imp<-nrow(imp[["researchDatabaseAndModelOutput"]])
}else{
RESDATA_imp<-0
}
SPIN<-dplyr::filter(imp_info,
imp_info$name=="spinOutOutput")
if(SPIN$len!=0){
SPIN_imp<-nrow(imp[["spinOutOutput"]])
}else{
SPIN_imp<-0
}
SUM<-dplyr::filter(imp_info,
imp_info$name=="impactSummaryOutput")
if(SUM$len!=0){
SUM_imp<-nrow(imp[["impactSummaryOutput"]])
}else{
SUM_imp<-0
}
FUR<-dplyr::filter(imp_info,
imp_info$name=="furtherFundingOutput")
if(FUR$len!=0){
FUR_imp<-nrow(imp[["furtherFundingOutput"]])
}else{
FUR_imp<-0
}
ORO<-dplyr::filter(imp_info,
imp_info$name=="otherResearchOutput")
if(ORO$len!=0){
ORO_imp<-nrow(imp[["otherResearchOutput"]])
}else{
ORO_imp<-0
}
EXPL<-dplyr::filter(imp_info,
imp_info$name=="exploitationOutput")
if(EXPL$len!=0){
EXPL_imp<-nrow(imp[["exploitationOutput"]])
}else{
EXPL_imp<-0
}
DISS<-dplyr::filter(imp_info,
imp_info$name=="disseminationOutput")
if(DISS$len!=0){
DISS_imp<-nrow(imp[["disseminationOutput"]])
}else{
DISS_imp<-0
}
top<-ORG$project$researchTopic
sub1<-ORG$project$researchSubject
PROJ<-tibble::tibble(project_title=ORG$project$title,
project_ref=ORG$project$grantReference,
abstract_text=ORG$project$abstractText,
project_value=ORG$project$fund$valuePounds,
start_date=ORG$project$fund$start,
end_date=ORG$project$fund$end,
topic=paste(top$text,collapse="_"),
subject=paste(sub1$text,collapse="_"),
num_collaboration_output=CO_imp,
num_intellectual_property_output=IP_imp,
num_policy_influence_output=POL_imp,
num_research_material_output=RM_imp,
num_artistic_creative_product_output=ART_imp,
num_software_technical_product_output=SOFT_imp,
num_research_database_model_output=RESDATA_imp,
num_spinout_output=SPIN_imp,
num_impact_summary_output=SUM_imp,
num_further_funding_output=FUR_imp,
num_other_research_output=ORO_imp,
num_exploitation_output=EXPL_imp,
num_dissemination_output=DISS_imp,
num_publications=PUB
)
#OM<-ORG$organisationRole
PR<-ORG$personRole
OMR<- sapply(unlist(PR$role,
recursive=FALSE, use.names=FALSE), "[", 1)
PersonRole<-tibble::tibble(person_id=unlist(PR$id),
first_name=unlist(PR$firstName),
surname=unlist(PR$surname),
other_name=unlist(PR$otherNames),
person_role=OMR)
PersonRole<-tibble::tibble(person_id=unlist(PR$id),
first_name=unlist(PR$firstName),
surname=unlist(PR$surname),
#other_name=unlist(PR$otherNames),
person_role=OMR)
#OM$
first_g<-gender::gender(names=PersonRole$first_name,
method="genderize")
PersonRole<-dplyr::mutate(PersonRole,gender=first_g$gender)
View(PersonRole)
PIG<-dplyr::filter(PersonRole,PersonRole$person_role=="PRINCIPAL_INVESTIGATOR")
PIgender=PIG$gender
library(GtR)
url<-"https://gtr.ukri.org:443/projects?ref=EP/T027584/1"
firmTEST<-httr::GET(url)
firmTEXT<-httr::content(firmTEST, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
ORG<-JLfirm$projectOverview$projectComposition
pt<-ORG$project$title
imp<-ORG$project$output
PUB<-nrow(ORG$project$publication)
imp_l<-list()
for (j in 1:length(imp)){
imp_l[[j]]<-length(imp[[j]])
}
imp_info<-data.frame(name=names(imp),len=unlist(imp_l))
CO<-dplyr::filter(imp_info,
imp_info$name=="collaborationOutput")
if(CO$len!=0){
CO_imp<-nrow(imp[["collaborationOutput"]])
}else{
CO_imp<-0
}
IP<-dplyr::filter(imp_info,
imp_info$name=="intellectualPropertyOutput")
if(IP$len!=0){
IP_imp<-nrow(imp[["intellectualPropertyOutput"]])
}else{
IP_imp<-0
}
POL<-dplyr::filter(imp_info,
imp_info$name=="policyInfluenceOutput")
if(POL$len!=0){
POL_imp<-nrow(imp[["policyInfluenceOutput"]])
}else{
POL_imp<-0
}
PROD<-dplyr::filter(imp_info,
imp_info$name=="productOutput")
if(PROD$len!=0){
PROD_imp<-nrow(imp[["productOutput"]])
}else{
PROD_imp<-0
}
RM<-dplyr::filter(imp_info,
imp_info$name=="researchMaterialOutput")
if(RM$len!=0){
RM_imp<-nrow(imp[["researchMaterialOutput"]])
}else{
RM_imp<-0
}
ART<-dplyr::filter(imp_info,
imp_info$name=="artisticAndCreativeProductOutput")
if(ART$len!=0){
ART_imp<-nrow(imp[["artisticAndCreativeProductOutput"]])
}else{
ART_imp<-0
}
SOFT<-dplyr::filter(imp_info,
imp_info$name=="softwareAndTechnicalProductOutput")
if(SOFT$len!=0){
SOFT_imp<-nrow(imp[["softwareAndTechnicalProductOutput"]])
}else{
SOFT_imp<-0
}
RESDATA<-dplyr::filter(imp_info,
imp_info$name=="researchDatabaseAndModelOutput")
if(RESDATA$len!=0){
RESDATA_imp<-nrow(imp[["researchDatabaseAndModelOutput"]])
}else{
RESDATA_imp<-0
}
SPIN<-dplyr::filter(imp_info,
imp_info$name=="spinOutOutput")
if(SPIN$len!=0){
SPIN_imp<-nrow(imp[["spinOutOutput"]])
}else{
SPIN_imp<-0
}
SUM<-dplyr::filter(imp_info,
imp_info$name=="impactSummaryOutput")
if(SUM$len!=0){
SUM_imp<-nrow(imp[["impactSummaryOutput"]])
}else{
SUM_imp<-0
}
FUR<-dplyr::filter(imp_info,
imp_info$name=="furtherFundingOutput")
if(FUR$len!=0){
FUR_imp<-nrow(imp[["furtherFundingOutput"]])
}else{
FUR_imp<-0
}
ORO<-dplyr::filter(imp_info,
imp_info$name=="otherResearchOutput")
if(ORO$len!=0){
ORO_imp<-nrow(imp[["otherResearchOutput"]])
}else{
ORO_imp<-0
}
EXPL<-dplyr::filter(imp_info,
imp_info$name=="exploitationOutput")
if(EXPL$len!=0){
EXPL_imp<-nrow(imp[["exploitationOutput"]])
}else{
EXPL_imp<-0
}
DISS<-dplyr::filter(imp_info,
imp_info$name=="disseminationOutput")
if(DISS$len!=0){
DISS_imp<-nrow(imp[["disseminationOutput"]])
}else{
DISS_imp<-0
}
top<-ORG$project$researchTopic
sub1<-ORG$project$researchSubject
PROJ<-tibble::tibble(project_title=ORG$project$title,
project_ref=ORG$project$grantReference,
abstract_text=ORG$project$abstractText,
project_value=ORG$project$fund$valuePounds,
start_date=ORG$project$fund$start,
end_date=ORG$project$fund$end,
topic=paste(top$text,collapse="_"),
subject=paste(sub1$text,collapse="_"),
num_collaboration_output=CO_imp,
num_intellectual_property_output=IP_imp,
num_policy_influence_output=POL_imp,
num_research_material_output=RM_imp,
num_artistic_creative_product_output=ART_imp,
num_software_technical_product_output=SOFT_imp,
num_research_database_model_output=RESDATA_imp,
num_spinout_output=SPIN_imp,
num_impact_summary_output=SUM_imp,
num_further_funding_output=FUR_imp,
num_other_research_output=ORO_imp,
num_exploitation_output=EXPL_imp,
num_dissemination_output=DISS_imp,
num_publications=PUB
)
paste(top$text,collapse="_")
paste(sub1$text,collapse="_")
PROJ<-tibble::tibble(project_title=ORG$project$title,
project_ref=ORG$project$grantReference,
abstract_text=ORG$project$abstractText,
project_value=ORG$project$fund$valuePounds,
start_date=ORG$project$fund$start,
end_date=ORG$project$fund$end,
#topic=paste(top$text,collapse="_"),
#subject=paste(sub1$text,collapse="_"),
num_collaboration_output=CO_imp,
num_intellectual_property_output=IP_imp,
num_policy_influence_output=POL_imp,
num_research_material_output=RM_imp,
num_artistic_creative_product_output=ART_imp,
num_software_technical_product_output=SOFT_imp,
num_research_database_model_output=RESDATA_imp,
num_spinout_output=SPIN_imp,
num_impact_summary_output=SUM_imp,
num_further_funding_output=FUR_imp,
num_other_research_output=ORO_imp,
num_exploitation_output=EXPL_imp,
num_dissemination_output=DISS_imp,
num_publications=PUB
)
purrr::is_empty(PUB)
if (purrr::is_empty(PUB)==TRUE){
PUB<-0
}else{PUB<-PUB}
library(GtR)
library(GtR)
library(GtR)
library(GtR)
library(GtR)
library(GtR)
library(GtR)
firmNAME<-gsub(" ", "+",search_term)
search_term<-"network science"
firmNAME<-gsub(" ", "+",search_term)
firmNAME<-gsub("&","%26",firmNAME)
url<-paste0("http://gtr.rcuk.ac.uk/search/project?term=")
firmTEST<-httr::GET(url)
firmTEXT<-httr::content(firmTEST, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
View(JLfirm)
MM<-JLfirm$total_results
MM<-JLfirm$headerData$lastRefreshDate
MM<-JLfirm$searchResult$didYouMean
MM<-JLfirm$searchResult$resourceHitCount
View(MM)
MM<-JLfirm$searchResult$results
url<-paste0("http://gtr.rcuk.ac.uk/search/project?term=",firmNAME)
firmTEST<-httr::GET(url)
firmTEXT<-httr::content(firmTEST, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
MM<-JLfirm$searchResult$results
View(MM)
View(MM[[1]][[1]])
View((MM[[1]][[1]])[[1]][[1]])
url<-paste0("http://gtr.rcuk.ac.uk/search/project?term=",firmNAME,"&page=1&fetchSize=25")
firmTEST<-httr::GET(url)
firmTEXT<-httr::content(firmTEST, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
MM<-JLfirm$searchResult$results
View(MM)
MM<-JLfirm$ad
MM<-JLfirm$headerData
View(firmTEST)
firmTEST<-httr::GET(url)
firmTEST$headers$`link-pages`
1084*25
pages<-firmTEST$headers$`link-pages`
url<-paste0("http://gtr.rcuk.ac.uk/search/project?term=",firmNAME,"&page=1&fetchSize=100")
firmTEST<-httr::GET(url)
pages<-firmTEST$headers$`link-pages`
firmTEXT<-httr::content(firmTEST, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
MM<-JLfirm$searchResult
MM<-JLfirm$searchResult$results
View(MM)
MM<-JLfirm$searchResult$results
colnames(MM)
retain<-c("projectComposition.project.title",
"projectComposition.project.grantCategory",
"projectComposition.project.id",
"projectComposition.project.url",
"projectComposition.project.fund.valuePounds",
"projectComposition.project.fund.start",
"projectComposition.project.fund.end",
"projectComposition.project.fund.type",
"projectComposition.project.fund.funder.name",
"projectComposition.leadResearchOrganisation.name"
)
MM2<-dplyr::select(MM,retain)
MM2<-dplyr::select(MM,all_of(retain))
?all_of
library(tidyselect)
retain<-c("projectComposition.project.title",
"projectComposition.project.grantCategory",
"projectComposition.project.id",
"projectComposition.project.url",
"projectComposition.project.fund.valuePounds",
"projectComposition.project.fund.start",
"projectComposition.project.fund.end",
"projectComposition.project.fund.type",
"projectComposition.project.fund.funder.name",
"projectComposition.leadResearchOrganisation.name"
)
url<-paste0("http://gtr.rcuk.ac.uk/search/project?term=",firmNAME,"&page=",j,"&fetchSize=100")
j<-1
url<-paste0("http://gtr.rcuk.ac.uk/search/project?term=",firmNAME,"&page=",j,"&fetchSize=100")
firmTEST2<-httr::GET(url)
firmTEXT<-httr::content(firmTEST2, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
MM<-JLfirm$searchResult$results
MM2<-dplyr::select(MM,tidyselect::all_of(retain))
View(MM2)
colnames(MM2)
for (j in 1:pages){
url<-paste0("http://gtr.rcuk.ac.uk/search/project?term=",firmNAME,"&page=",j,"&fetchSize=100")
firmTEST2<-httr::GET(url)
firmTEXT<-httr::content(firmTEST2, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
MM<-JLfirm$searchResult$results
MM2<-dplyr::select(MM,tidyselect::all_of(retain))
colnames(MM2)<-c("project_title", "grant_category",
"project_id","project_url",
"value",
"start_date","end_date",
"fund_type","funder",
"lead_org")
res_list[[j]]<-MM2
}
res_list<-list()
for (j in 1:pages){
url<-paste0("http://gtr.rcuk.ac.uk/search/project?term=",firmNAME,"&page=",j,"&fetchSize=100")
firmTEST2<-httr::GET(url)
firmTEXT<-httr::content(firmTEST2, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
MM<-JLfirm$searchResult$results
MM2<-dplyr::select(MM,tidyselect::all_of(retain))
colnames(MM2)<-c("project_title", "grant_category",
"project_id","project_url",
"value",
"start_date","end_date",
"fund_type","funder",
"lead_org")
res_list[[j]]<-MM2
}
res_data_frame<-purrr::map_df(res_list,data.frame)
View(res_data_frame)
library(GtR)
library(GtR)
library(pander)
library(GtR)
library(GtR)
library(GtR)
url<-"https://gtr.ukri.org:443/projects?ref=2071894"
firmTEST<-httr::GET(url)
firmTEXT<-httr::content(firmTEST, as="text")
JLfirm<-jsonlite::fromJSON(firmTEXT, flatten=TRUE)
ORG<-JLfirm$projectOverview$projectComposition
pt<-ORG$project$title
imp<-ORG$project$output
PUB<-nrow(ORG$project$publication)
if (purrr::is_empty(PUB)==TRUE){
PUB<-0
}else{PUB<-PUB}
imp_l<-list()
for (j in 1:length(imp)){
imp_l[[j]]<-length(imp[[j]])
}
imp<-ORG$project$output
purrr::is_empty(imp)
if(purrr::is_empty(imp)==TRUE){
names_imp1<-c("collaborationOutput",
"intellectualPropertyOutput",
"policyInfluenceOutput",
"productOutput",
"researchMaterialOutput",
"artisticAndCreativeProductOutput",
"softwareAndTechnicalProductOutput",
"researchDatabaseAndModelOutput",
"spinOutOutput",
"impactSummaryOutput",
"furtherFundingOutput",
"otherResearchOutput",
"exploitationOutput",
"disseminationOutput")
imp_info<-dplyr::tibble(name=names_imp1,len=0)
}else{
imp_l<-list()
for (j in 1:length(imp)){
imp_l[[j]]<-length(imp[[j]])
}
imp_info<-data.frame(name=names(imp),len=unlist(imp_l))
}
CO<-dplyr::filter(imp_info,
imp_info$name=="collaborationOutput")
if(CO$len!=0){
CO_imp<-nrow(imp[["collaborationOutput"]])
}else{
CO_imp<-0
}
library(GtR)
library(GtR)
library(GtR)
library(GtR)
library(GtR)
library(GtR)
library(GtR)
